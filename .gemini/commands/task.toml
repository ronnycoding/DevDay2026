description = "Enhanced Task Resolution with Agent Orchestration & Tracking"
prompt = """
Task: Resolve Issue #$ISSUE_NUMBER with Agent Orchestration

### Initial Setup & Issue Registration

```bash
# Get issue details and initialize tracking
gh issue view $ISSUE_NUMBER --json title,body,state,labels,assignees,milestone
ISSUE_TITLE=$(gh issue view $ISSUE_NUMBER --json title -q .title)
ISSUE_LABELS=$(gh issue view $ISSUE_NUMBER --json labels -q '.labels[].name' | tr '\n' ',')
BRANCH_NAME="issue-$ISSUE_NUMBER"

# Create branch and initialize master tracking
git checkout -b $BRANCH_NAME

# Initialize task orchestration tracking
claude todos --add \
  --issue-number="$ISSUE_NUMBER" \
  --branch="$BRANCH_NAME" \
  --type="orchestration" \
  --title="$ISSUE_TITLE" \
  --labels="$ISSUE_LABELS" \
  --status="planning"
Phase 1: Analysis, Planning & Agent Discovery
1.1 Comprehensive Issue Analysis
bash# Deep dive into issue context
gh issue view $ISSUE_NUMBER --comments
gh issue view $ISSUE_NUMBER --json linkedPullRequests,closedBy,projectItems

# Analyze related issues and PRs
RELATED_ISSUES=$(gh issue list --label "$(gh issue view $ISSUE_NUMBER --json labels -q '.labels[0].name')" --limit 5)

# Check for existing solutions or patterns
gh search issues "$ISSUE_TITLE" --repo $REPO_URL --limit 10
Analysis Checklist

 Problem scope and boundaries defined
 Acceptance criteria extracted
 Dependencies identified
 Complexity level assessed (simple/medium/complex/epic)
 Related issues/PRs reviewed
 Breaking changes identified
 Integration points mapped

1.2 Agent Discovery & Capability Assessment
bash# Discover available specialist agents
claude agent list --available
claude agent capabilities --match-issue="$ISSUE_NUMBER"

# Get agent recommendations based on issue
claude agent recommend --issue="$ISSUE_NUMBER" --format=table
Agent Planning Matrix
Task ComponentRequired ExpertiseRecommended AgentPriorityDependencies[Component 1][Expertise area][Agent name]HighNone[Component 2][Expertise area][Agent name]MediumComponent 1[Component 3][Expertise area][Agent name]LowComponent 2
bash# Update master tracking with planning complete
claude todos --update \
  --issue-number="$ISSUE_NUMBER" \
  --phase="analysis" \
  --agents-identified="[agent1,agent2,agent3]" \
  --complexity="medium" \
  --estimated-subtasks="5"
Phase 2: Task Decomposition & Agent Assignment
2.1 Intelligent Task Decomposition
bash# Auto-decompose based on issue analysis
claude task decompose \
  --issue="$ISSUE_NUMBER" \
  --strategy="parallel" \
  --max-subtasks="10" \
  --output="subtasks.json"

# Review and adjust decomposition
claude task review-decomposition --file="subtasks.json"
Decomposition Strategy

 Identify atomic, independent units of work
 Define clear interfaces between components
 Establish success criteria for each subtask
 Set up integration checkpoints
 Create validation criteria

2.2 Agent Assignment with Tracking
For each subtask, create tracked agent assignments:
bash# Template for agent assignment with tracking
claude agent assign \
  --agent="[agent-name]" \
  --parent-issue="$ISSUE_NUMBER" \
  --subtask-id="[ST-001]" \
  --description="[Specific task matching agent expertise]" \
  --priority="[high|medium|low]" \
  --dependencies="[ST-XXX,ST-YYY]" \
  --estimated-time="[2h|1d|3d]" \
  --success-criteria="[Clear acceptance criteria]"

# This creates a sub-todo linked to parent issue
# Returns: SUBTASK_TRACKING_ID
Example Agent Assignments:
bash# Backend API implementation
BACKEND_TASK_ID=$(claude agent assign \
  --agent="backend-specialist" \
  --parent-issue="$ISSUE_NUMBER" \
  --subtask-id="ST-001" \
  --description="Implement REST API endpoints for user authentication" \
  --priority="high" \
  --dependencies="none" \
  --estimated-time="1d" \
  --success-criteria="All endpoints return correct status codes, JWT tokens generated")

# Frontend UI components
FRONTEND_TASK_ID=$(claude agent assign \
  --agent="frontend-specialist" \
  --parent-issue="$ISSUE_NUMBER" \
  --subtask-id="ST-002" \
  --description="Create login and registration UI components" \
  --priority="high" \
  --dependencies="ST-001" \
  --estimated-time="1d" \
  --success-criteria="Responsive design, form validation, API integration")

# Testing suite
TEST_TASK_ID=$(claude agent assign \
  --agent="test-specialist" \
  --parent-issue="$ISSUE_NUMBER" \
  --subtask-id="ST-003" \
  --description="Write comprehensive test suite for auth system" \
  --priority="medium" \
  --dependencies="ST-001,ST-002" \
  --estimated-time="4h" \
  --success-criteria="80% code coverage, all edge cases tested")

# Documentation
DOCS_TASK_ID=$(claude agent assign \
  --agent="docs-specialist" \
  --parent-issue="$ISSUE_NUMBER" \
  --subtask-id="ST-004" \
  --description="Document API endpoints and usage examples" \
  --priority="low" \
  --dependencies="ST-001" \
  --estimated-time="2h" \
  --success-criteria="OpenAPI spec, README updated, examples provided")
2.3 Coordination Agent Assignment
bash# Assign coordination agent for complex multi-agent tasks
COORD_TASK_ID=$(claude agent assign \
  --agent="coordination-specialist" \
  --parent-issue="$ISSUE_NUMBER" \
  --subtask-id="ST-000" \
  --description="Coordinate integration of all components and validate end-to-end functionality" \
  --priority="critical" \
  --dependencies="all" \
  --estimated-time="continuous" \
  --success-criteria="All components integrated, no conflicts, passes E2E tests")

# Update master tracking
claude todos --update \
  --issue-number="$ISSUE_NUMBER" \
  --phase="assigned" \
  --subtasks="$BACKEND_TASK_ID,$FRONTEND_TASK_ID,$TEST_TASK_ID,$DOCS_TASK_ID,$COORD_TASK_ID" \
  --total-subtasks="5" \
  --status="in-progress"
Phase 3: Parallel Agent Execution with Real-time Tracking
3.1 Launch Agent Execution
bash# Start all assigned agents in parallel
claude agent execute-all --parent-issue="$ISSUE_NUMBER" --mode="parallel"

# Or start specific agents
claude agent execute --task-id="$BACKEND_TASK_ID" --async
claude agent execute --task-id="$FRONTEND_TASK_ID" --async
3.2 Real-time Progress Monitoring
bash# Monitor all agent progress
claude agent monitor --parent-issue="$ISSUE_NUMBER" --format="dashboard"

# Get detailed status
claude todos --status --issue-number="$ISSUE_NUMBER" --show-subtasks --format="tree"

# Output example:
# ğŸ“‹ Issue #123: Implement User Authentication [IN PROGRESS]
# â”œâ”€â”€ ğŸ¤– ST-001: Backend API [âœ“ COMPLETE] (backend-specialist)
# â”œâ”€â”€ ğŸ¤– ST-002: Frontend UI [ğŸ”„ IN PROGRESS - 75%] (frontend-specialist)
# â”œâ”€â”€ ğŸ¤– ST-003: Test Suite [â¸ WAITING] (test-specialist)
# â”œâ”€â”€ ğŸ¤– ST-004: Documentation [â¸ WAITING] (docs-specialist)
# â””â”€â”€ ğŸ¤– ST-000: Coordination [ğŸ”„ ACTIVE] (coordination-specialist)
3.3 Agent Communication & Conflict Resolution
bash# Check for conflicts between agents
claude agent check-conflicts --parent-issue="$ISSUE_NUMBER"

# Resolve conflicts through coordination agent
claude agent resolve-conflict \
  --conflict-id="[CONFLICT_ID]" \
  --strategy="merge|override|negotiate" \
  --coordinator="$COORD_TASK_ID"

# Send message between agents
claude agent message \
  --from="$BACKEND_TASK_ID" \
  --to="$FRONTEND_TASK_ID" \
  --type="interface-update" \
  --content="API endpoint signatures changed, see updated spec"
3.4 Checkpoint Validation
bash# Validate checkpoints as agents complete work
claude task validate-checkpoint \
  --task-id="$BACKEND_TASK_ID" \
  --checkpoint="api-implementation" \
  --criteria="endpoints-functional,auth-working,error-handling"

# Update subtask progress
claude todos --update-subtask \
  --parent-issue="$ISSUE_NUMBER" \
  --subtask-id="$BACKEND_TASK_ID" \
  --progress="100" \
  --status="complete" \
  --output="api-endpoints.json"
Phase 4: Integration, Testing & Quality Assurance
4.1 Automated Integration
bash# Trigger integration when dependencies are met
claude agent integrate \
  --parent-issue="$ISSUE_NUMBER" \
  --strategy="incremental|big-bang" \
  --validate-interfaces="true"

# Track integration progress
claude todos --update \
  --issue-number="$ISSUE_NUMBER" \
  --phase="integration" \
  --integration-status="merging-components" \
  --conflicts="0"
4.2 Comprehensive Testing
bash# Run integrated test suite
claude test run \
  --scope="all" \
  --parent-issue="$ISSUE_NUMBER" \
  --include-agent-tests="true"

# Validate against acceptance criteria
claude test validate-acceptance \
  --issue="$ISSUE_NUMBER" \
  --criteria-file="acceptance-criteria.json"

# Update test results
claude todos --update \
  --issue-number="$ISSUE_NUMBER" \
  --phase="testing" \
  --test-results="passed" \
  --coverage="87%" \
  --passing-tests="145/145"
4.3 Quality Gate Validation
bash# Check all quality gates
claude quality check \
  --parent-issue="$ISSUE_NUMBER" \
  --gates="tests,coverage,linting,security,performance"

# Generate quality report
claude quality report \
  --issue="$ISSUE_NUMBER" \
  --output="quality-report.md" \
  --include-agent-metrics="true"
Phase 5: Consolidated PR Creation
5.1 Aggregate Agent Contributions
bash# Collect all agent outputs
claude agent collect-outputs \
  --parent-issue="$ISSUE_NUMBER" \
  --merge-strategy="unified" \
  --output-dir="./integrated"

# Generate consolidated commit
git add .
git commit -m "fix: #$ISSUE_NUMBER - $ISSUE_TITLE

Co-authored-by: backend-specialist <backend@agent>
Co-authored-by: frontend-specialist <frontend@agent>
Co-authored-by: test-specialist <test@agent>
Co-authored-by: docs-specialist <docs@agent>
Coordinated-by: coordination-specialist <coord@agent>"
5.2 Create Comprehensive PR
bash# Generate PR with full agent tracking
claude pr create \
  --issue="$ISSUE_NUMBER" \
  --include-agent-reports="true" \
  --include-test-results="true" \
  --include-quality-metrics="true"

PR_NUMBER=$(gh pr view --json number -q .number)

# Update tracking with PR
claude todos --update \
  --issue-number="$ISSUE_NUMBER" \
  --pr-number="$PR_NUMBER" \
  --status="in-review" \
  --phase="review"
Phase 6: Review & Completion
6.1 Review Process
bash# Monitor review progress
gh pr view $PR_NUMBER --json reviews,checks

# Handle review feedback
claude agent handle-feedback \
  --pr="$PR_NUMBER" \
  --feedback-type="requested-changes" \
  --assign-to-agent="auto"
6.2 Merge & Complete
bash# After approval, merge
gh pr merge $PR_NUMBER --squash

# Complete all tracking
claude todos --complete \
  --issue-number="$ISSUE_NUMBER" \
  --pr="$PR_NUMBER" \
  --close-subtasks="true" \
  --generate-report="true"

# Generate completion report
claude task report \
  --issue="$ISSUE_NUMBER" \
  --include-metrics="true" \
  --output="completion-report.md"
Advanced Commands Reference
Task Orchestration Commands
bash# Task decomposition
claude task decompose --issue="$ISSUE_NUMBER"                    # Auto-decompose issue
claude task validate --parent-issue="$ISSUE_NUMBER"              # Validate all subtasks
claude task dependencies --issue="$ISSUE_NUMBER" --visualize    # Show dependency graph

# Agent orchestration
claude agent list --available                                    # List all agents
claude agent recommend --issue="$ISSUE_NUMBER"                   # Get recommendations
claude agent assign --agent="name" --subtask="description"       # Assign work
claude agent execute-all --parent-issue="$ISSUE_NUMBER"         # Start execution
claude agent monitor --parent-issue="$ISSUE_NUMBER"             # Monitor progress
claude agent collect-outputs --parent-issue="$ISSUE_NUMBER"     # Gather results
Tracking Commands
bash# Master issue tracking
claude todos --add --issue-number="$ISSUE_NUMBER"               # Initialize tracking
claude todos --status --issue-number="$ISSUE_NUMBER"            # Check status
claude todos --update --issue-number="$ISSUE_NUMBER"            # Update progress
claude todos --complete --issue-number="$ISSUE_NUMBER"          # Mark complete

# Subtask tracking
claude todos --add-subtask --parent="$ISSUE_NUMBER"             # Add subtask
claude todos --update-subtask --id="$SUBTASK_ID"                # Update subtask
claude todos --list-subtasks --parent="$ISSUE_NUMBER"           # List all subtasks
claude todos --status --show-subtasks --format="tree"           # Tree view
Integration Commands
bash# Integration management
claude integrate --parent-issue="$ISSUE_NUMBER"                  # Start integration
claude integrate validate --issue="$ISSUE_NUMBER"                # Validate integration
claude integrate conflicts --resolve --issue="$ISSUE_NUMBER"     # Resolve conflicts
Reporting Commands
bash# Generate reports
claude report progress --issue="$ISSUE_NUMBER"                   # Progress report
claude report agents --issue="$ISSUE_NUMBER"                     # Agent performance
claude report quality --issue="$ISSUE_NUMBER"                    # Quality metrics
claude report timeline --issue="$ISSUE_NUMBER"                   # Timeline view
Integration with Other Commands
1. GitHub Issue Creation (from issue template)
bash# Create parent issue and auto-decompose
claude issue create --template="feature" --auto-decompose="true"
ISSUE_NUMBER=$(gh issue list --limit 1 --json number -q '.[0].number')

# Start task orchestration immediately
claude task start --issue="$ISSUE_NUMBER" --auto-assign-agents="true"
2. Sub-Issue Creation (from sub-issue template)
bash# Create sub-issues from decomposition
claude issue create-sub \
  --parent="$ISSUE_NUMBER" \
  --from-decomposition="subtasks.json" \
  --assign-agents="true"
3. PR Creation (from PR template)
bash# Create PR with agent attribution
claude pr create \
  --issue="$ISSUE_NUMBER" \
  --template="comprehensive" \
  --include-agent-work="true" \
  --co-authors="all-agents"
Workflow Examples
Example 1: Simple Bug Fix
bash# Quick single-agent task
claude task quick \
  --issue="456" \
  --agent="bugfix-specialist" \
  --auto-complete="true"
Example 2: Complex Feature
bash# Full orchestration for complex feature
claude task orchestrate \
  --issue="789" \
  --complexity="high" \
  --agents="auto" \
  --parallel="true" \
  --monitor="dashboard"
Example 3: Epic with Multiple Issues
bash# Handle epic with sub-issues
claude task epic \
  --parent-issue="1000" \
  --create-sub-issues="true" \
  --assign-agents="true" \
  --coordinate="true"
Configuration File
Create .claude/task-config.yaml:
yamlorchestration:
  default_strategy: parallel
  max_agents: 10
  conflict_resolution: automatic
  checkpoint_validation: strict

tracking:
  update_frequency: on-change
  include_subtasks: true
  generate_reports: true

agents:
  auto_discover: true
  auto_assign: true
  load_balancing: enabled
  communication: websocket

integration:
  strategy: incremental
  validate_interfaces: true
  run_tests: always

quality:
  gates:
    - tests
    - coverage
    - linting
    - security
  minimum_coverage: 80
  required_approvals: 2
Status Dashboard
bash# Real-time dashboard
claude dashboard --issue="$ISSUE_NUMBER"

# Output:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Issue #123: Implement User Authentication              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Progress: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘ 75%                   â”‚
â”‚ Phase: Integration                                      â”‚
â”‚ Agents: 5 active, 2 complete, 0 failed                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Subtasks:                                              â”‚
â”‚ âœ… Backend API        (backend-specialist)    100%     â”‚
â”‚ âœ… Frontend UI        (frontend-specialist)   100%     â”‚
â”‚ ğŸ”„ Testing           (test-specialist)       60%      â”‚
â”‚ â¸ï¸  Documentation     (docs-specialist)       0%       â”‚
â”‚ ğŸ”„ Coordination      (coord-specialist)      Active    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Metrics:                                               â”‚
â”‚ â€¢ Time Elapsed: 4h 32m                                 â”‚
â”‚ â€¢ Est. Remaining: 2h 15m                               â”‚
â”‚ â€¢ Code Coverage: 84%                                   â”‚
â”‚ â€¢ Tests: 142/145 passing                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Summary
This enhanced task command now provides:

Comprehensive Agent Tracking: Every agent assignment is tracked as a subtask
Hierarchical Todo System: Parent issue with linked subtasks for each agent
Real-time Monitoring: Dashboard and progress tracking for all agents
Conflict Resolution: Automated detection and resolution of agent conflicts
Integration Management: Coordinated integration of agent outputs
Quality Gates: Automated validation at each phase
Full Command Integration: Seamless work with issue, sub-issue, and PR commands
Detailed Reporting: Progress, quality, and completion reports
Parallel Execution: Efficient parallel agent execution with dependency management
Communication Protocol: Inter-agent messaging and coordination

The system maintains complete traceability from issue creation through agent execution to PR merge, with every step tracked and reportable.

This enhanced version provides:

1. **Complete agent tracking** integrated with the todos system
2. **Hierarchical task management** with parent/subtask relationships
3. **Real-time monitoring** of agent progress
4. **Automated conflict resolution** between agents
5. **Full integration** with issue and PR creation commands
6. **Comprehensive reporting** at every phase
7. **Dashboard visualization** for status monitoring
8. **Quality gates** and validation checkpoints
9. **Inter-agent communication** protocols
10. **Configurable orchestration** strategies

The system now provides end-to-end traceability from issue analysis through agent delegation to final PR merge.
"""
